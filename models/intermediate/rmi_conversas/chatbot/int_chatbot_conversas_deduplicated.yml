version: 2

models:
  - name: int_chatbot_conversas_deduplicated
    description: "Conversas deduplicated - uma por HSM+telefone (mais recente)"
    
    columns:
      - name: id_hsm
        description: "ID da HSM"
        tests:
          - not_null
          
      - name: telefone_contato
        description: "Telefone de contato"
        tests:
          - not_null

    tests:
      # Should have 1:1 relationship with HSM+phone combinations
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - id_hsm
            - telefone_contato
            
      # Should have reasonable volume (not millions)
      - dbt_utils.expression_is_true:
          expression: "(select count(*) from {{ this }}) <= 100000"
          config:
            error_if: ">= 1"